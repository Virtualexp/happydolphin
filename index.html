<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>welcome!</title>

<!-- Sadece pencere stilini almak i√ßin 98.css -->
<link rel="stylesheet" href="https://unpkg.com/98.css/dist/98.css">

<style>
  body {
    background-image: url('waves.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    color: #40FFB0;
    font-family: "VT323", monospace;
    height: 100vh;
    margin: 0;
    overflow: hidden;
  }

  body::after {
    content: "";
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0, 0, 20, 0.35);
    pointer-events: none;
  }

  .center-content {
    position: absolute;
    top: 8%;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    text-align: center;
    z-index: 1;
  }

  h1 {
    position: relative;
    top: -40px;
    font-size: 48px;
    color: #7CFFB2;
    text-shadow: 0 0 8px #40FFB0, 0 0 15px rgba(64,255,176,0.5);
    margin: 0;
    letter-spacing: 2px;
  }

  .profile {
    width: 340px;
    height: 340px;
    border: 2px solid #40FFB0;
    border-radius: 50%;
    background-image: url('dolphin.jpg');
    background-size: cover;
    background-position: center;
    box-shadow: 0 0 25px #40FFB0;
  }

  .win98 {
    position: absolute;
    width: 340px;
    z-index: 999;
    touch-action: none;
    transform: scale(1.3); /* %130 b√ºy√ºt√ºr */
    transform-origin: center; /* sol √ºst k√∂≈üeden b√ºy√ºr */
  }


  .trail {
    position: absolute;
    pointer-events: none;
    opacity: 1;
    transition: opacity 3s linear;
  }

  /* PENCERE ƒ∞√áƒ∞NDEKƒ∞ YAZILAR VE RENGƒ∞ 98.CSS STƒ∞Lƒ∞NDE OLSUN */
  .window-body, .message-text, .cmd-input, .button {
    font-family: "MS Sans Serif", sans-serif !important;
    color: black !important;
    font-size: medium !important;
  }

  .window-body {
    background-color: #c0c0c0 !important;
  }

  .cmd-input {
    background: white !important;
    color: black !important;
    font-size: 18px !important;
    border: inset 2px #fff;
  }

  /* üê¨ DOLPHIN ICON SABƒ∞T BOYUTTA KALSIN */
  .message-icon {
    width: 32px;
    height: 32px;
    image-rendering: pixelated;
    object-fit: contain;
  }

  @media (max-width: 600px) {
    .message-icon {
      width: 24px;
      height: 24px;
    }
  }

/* üåê Network Mirage efektleri */
body.network-mirage {
  filter: blur(0.6px) brightness(1.05) saturate(1.1) hue-rotate(8deg);
}

body.network-mirage.end {
  filter: none;
}

/* üîí Network Mirage sƒ±rasƒ±nda etkile≈üim kilidi */
#mirage-lock {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(0.2px);
  z-index: 9998;
  pointer-events: all; /* her tƒ±klamayƒ± yakalar */
  cursor: not-allowed;
}


</style>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6XYJWCW1GJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-6XYJWCW1GJ');
</script>
</head>

<body>
  <div class="center-content">
    <h1>totaly not a virus, trust me..</h1>
    <div class="profile"></div>
  </div>

<script>
let clickCount = 0, zCounter = 1000, windowIndex = 0;
const MAX_WINDOWS = 7, OFFSET_X = 30, OFFSET_Y = 30;

const seaSound = new Audio('underwatersound.mp3');
seaSound.loop = true; seaSound.volume = 0.5;
const dolphinSound = new Audio('dolphinsound.mp3');
dolphinSound.volume = 0.5;

window.addEventListener('click', function initSound() {
  seaSound.play().catch(()=>{});
  window.removeEventListener('click', initSound);
});

let qset = [];
let usedQuestions = JSON.parse(localStorage.getItem("usedQuestions") || "[]");

fetch('questions.json')
  .then(r => r.json())
  .then(data => qset = data)
  .catch(err => console.error("questions.json y√ºklenemedi:", err));

function getUniqueQuestion() {
  if (!qset.length) return null;
  if (usedQuestions.length >= qset.length) {
    usedQuestions = [];
    localStorage.removeItem("usedQuestions");
  }
  const available = qset.filter(q => !usedQuestions.includes(q.q));
  const chosen = available[Math.floor(Math.random() * available.length)];
  usedQuestions.push(chosen.q);
  localStorage.setItem("usedQuestions", JSON.stringify(usedQuestions));
  return chosen;
}

let usedMessages = [];
const messages = [
  "so, are you sure you want to click this button?",
  "hmm... interesting choice.",
  "you really thought this was the last one?",
  "don‚Äôt trust the dolphin.",
  "the ocean is watching.",
  "trust issues detected.",
  "maybe... stop?",
  "i‚Äôm starting to think you like chaos.",
  "curiosity sinks deeper, doesn‚Äôt it?",
  "something beneath is listening.",
  "each click wakes another current.",
  "even data drowns eventually.",
  "you call it control, the sea calls it surrender.",
  "somewhere a dolphin laughs at your confidence.",
  "keep clicking... it feeds the algorithm.",
  "your reflection is lagging behind.",
  "waves remember, even when you don‚Äôt.",
  "did you just feel that ripple?",
  "the water hums your name now.",
  "every button is a confession.",
  "stop pretending you‚Äôre the user.",
  "you can‚Äôt debug the tide.",
  "your mouse is dripping salt.",
  "this is not a glitch. it‚Äôs a pulse.",
  "depth pressure rising‚Ä¶ continue?",
  "you‚Äôre teaching the system how you think.",
  "the ocean reads your hesitation.",
  "each ‚Äòyes‚Äô costs a memory.",
  "some dolphins never surface again.",
  "clicks echo longer underwater."
];


function getUniqueMessage() {
  if (usedMessages.length >= messages.length) usedMessages = [];
  const available = messages.filter(m => !usedMessages.includes(m));
  const chosen = available[Math.floor(Math.random() * available.length)];
  usedMessages.push(chosen);
  return chosen;
}

// ‚ö†Ô∏è Basit sistem hatasƒ± popup‚Äôƒ± (mobil ve masa√ºst√º uyumlu)
function showRetroAlert(message) {
  // popup √ßaƒürƒ±sƒ±nƒ± event zinciri dƒ±≈üƒ±na ta≈üƒ±r
  setTimeout(() => {
    alert(message);
  }, 0);
}




function createWindow(x, y) {
  windowIndex++;
  const wrapper = document.createElement('div');
  wrapper.className = 'win98';
  wrapper.style.left = (x ?? 100) + 'px';
  wrapper.style.top = (y ?? 100) + 'px';
  wrapper.style.zIndex = ++zCounter;

  const chance = Math.random();
  let mode = "normal";
  if (chance < 0.30) mode = "terminal";
  else if (chance < 0.2) mode = "runaway";

  const randomMessage = getUniqueMessage();

  let html = "";
  if (mode === "terminal") {
    html = `
      <div class="window" style="width:280px;">
        <div class="title-bar">
          <div class="title-bar-text">Deep Sea Protocol</div>
          <div class="title-bar-controls">
            <button aria-label="Close" class="close-ind"></button>
          </div>
        </div>
        <div class="window-body">
          <p class="message-text">&gt; access marine archive...</p>
          <div style="display: flex; justify-content: center; margin-top: 45px">
  <input type="text" class="cmd-input" placeholder="type command..." style="width: 95%; height: 28px;">
</div>

          <section class="field-row" style="justify-content:end; margin-top: 20px;">
            <button class="button">Execute</button>
          </section>

        </div>
      </div>`;
  } else {
    html = `
      <div class="window" style="width:320px;">
        <div class="title-bar">
          <div class="title-bar-text">OceanOS</div>
          <div class="title-bar-controls">
            <button aria-label="Close" class="close-ind"></button>
          </div>
        </div>
        <div class="window-body">
          <div class="field-row" style="align-items:flex-start; gap:12px; margin-top:30px; justify-content:center;">
            <img src="dolphinmini.png" class="message-icon" style="transform: scale(1.5); transform-origin: center;" alt="icon">
            <div class="message-text">${randomMessage}</div>
          </div>
          <section class="field-row" style="justify-content:end; margin-top: 20px;">
            <button class="button">Yes, but</button>
          </section>
        </div>
      </div>`;
  }

  wrapper.innerHTML = html;
  document.body.appendChild(wrapper);
  dolphinSound.currentTime = 0;
  dolphinSound.play().catch(()=>{});


const closeBtn = wrapper.querySelector('.close-ind');
if (closeBtn) {
  const showError = () => showRetroAlert("sorry but answer the question first ¬Ø\\_(„ÉÑ)_/¬Ø");

  // Masa√ºst√º ve mobil uyumlu: pointer + click
  closeBtn.addEventListener('pointerdown', e => {
    e.preventDefault();
    e.stopPropagation();
    showError();
  });
  closeBtn.addEventListener('click', e => {
    e.preventDefault();
    e.stopPropagation();
    showError();
  });
}



  if (mode === "terminal") setupTerminal(wrapper);
  else if (mode === "runaway") setupRunaway(wrapper);
  else setupNormal(wrapper);

  makeDraggable(wrapper, wrapper.querySelector('.title-bar'));
}

function setupNormal(wrapper) {
  const btn = wrapper.querySelector('.button');
  btn.addEventListener('click', () => {
    clickCount++;
    const rect = wrapper.getBoundingClientRect();
    wrapper.remove();
    if (clickCount < MAX_WINDOWS) createWindow(rect.left + OFFSET_X, rect.top + OFFSET_Y);
    else window.location.href = "https://www.youtube.com/watch?v=WQO-aOdJLiw";
  });
}

function setupRunaway(wrapper) {
  const btn = wrapper.querySelector('.button');
  wrapper.style.transition = 'left 0.25s ease-out, top 0.25s ease-out';

  // üîπ Ka√ßma davranƒ±≈üƒ±
  wrapper.addEventListener('mousemove', (e) => {
    const rect = btn.getBoundingClientRect();
    const dist = Math.hypot(
      e.clientX - (rect.left + rect.width / 2),
      e.clientY - (rect.top + rect.height / 2)
    );
    if (dist < 80) {
      let newLeft = parseInt(wrapper.style.left) + (Math.random() * 100 - 50);
      let newTop = parseInt(wrapper.style.top) + (Math.random() * 100 - 50);
      newLeft = Math.max(0, Math.min(window.innerWidth - wrapper.offsetWidth, newLeft));
      newTop = Math.max(0, Math.min(window.innerHeight - wrapper.offsetHeight, newTop));
      wrapper.style.left = newLeft + 'px';
      wrapper.style.top = newTop + 'px';
    }
  });

  // üîπ Kullanƒ±cƒ± butona basmayƒ± ba≈üarƒ±rsa: normal akƒ±≈üa ge√ß
  btn.addEventListener('click', () => {
    clickCount++;
    const rect = wrapper.getBoundingClientRect();
    wrapper.remove();
    if (clickCount < MAX_WINDOWS) {
      createWindow(rect.left + OFFSET_X, rect.top + OFFSET_Y);
    } else {
      window.location.href = "https://www.youtube.com/watch?v=WQO-aOdJLiw";
    }
  });
}


function setupTerminal(wrapper) {
  const input = wrapper.querySelector('.cmd-input');
  const btn = wrapper.querySelector('.button');
  const output = wrapper.querySelector('.message-text');

  if (!qset.length) {
    output.textContent = "> loading...";
    setTimeout(() => setupTerminal(wrapper), 500);
    return;
  }

  const chosen = getUniqueQuestion();
  output.textContent = "> " + chosen.q;
  let answered = false;

  btn.addEventListener('click', runCmd);
  input.addEventListener('keydown', e => { if (e.key === 'Enter') runCmd(); });

  function runCmd() {
    const cmd = input.value.trim().toLowerCase();
    input.value = "";
    if (!answered) {
      if (cmd === "yes" || cmd === "no") {
        answered = true;
        input.style.display = 'none';
        btn.style.display = 'none';
        output.textContent = chosen[cmd];
        chainDolphinSounds();
        setTimeout(() => {
          if (Math.random() < 0.5) document.querySelectorAll('.win98').forEach(e => e.remove());
          else wrapper.remove();
          centerWindow();
        }, 1200);
      } else output.textContent = "> answer with 'yes' or 'no'.";
    }
  }
}

function chainDolphinSounds() {
  for (let i = 0; i < 11; i++) {
    setTimeout(() => {
      const s = dolphinSound.cloneNode();
      s.volume = 0.4 - i * 0.05;
      s.play().catch(()=>{});
    }, i * 400);
  }
}

function makeDraggable(wrapper, handle) {
  let offsetX = 0, offsetY = 0, isDragging = false;
  let lastTrailTime = 0; // üîπ yeni: trail sƒ±klƒ±ƒüƒ± kontrol√º

  handle.addEventListener('pointerdown', e => {
    isDragging = true;
    offsetX = e.clientX - wrapper.offsetLeft;
    offsetY = e.clientY - wrapper.offsetTop;
    handle.setPointerCapture(e.pointerId);
  });

  handle.addEventListener('pointerup', e => {
    isDragging = false;
    handle.releasePointerCapture(e.pointerId);
  });

  handle.addEventListener('pointermove', e => {
    if (!isDragging) return;

    const newLeft = e.clientX - offsetX;
    const newTop = e.clientY - offsetY;

    const now = Date.now();
    // üîπ Trail olu≈üturma frekansƒ±nƒ± azalt (√∂rneƒüin her 50ms)
    if (now - lastTrailTime > 30) {
      const trail = wrapper.cloneNode(true);
      trail.classList.add('trail');
      trail.style.left = wrapper.style.left;
      trail.style.top = wrapper.style.top;
      trail.style.opacity = '0.4';
      trail.style.zIndex = wrapper.style.zIndex - 1;
      document.body.appendChild(trail);

      // üîπ Trail ekranda daha uzun kalsƒ±n (√∂rneƒüin 700ms)
      setTimeout(() => {
        trail.style.opacity = '0';
        setTimeout(() => trail.remove(), 1000);
      }, 0);

      lastTrailTime = now;
    }

    wrapper.style.left = newLeft + 'px';
    wrapper.style.top = newTop + 'px';
  });
}



function centerWindow() {
  createWindow((window.innerWidth - 340) / 2, (window.innerHeight - 200) / 2 + 100);
}
centerWindow();

// ===== üåê Network Mirage ‚Äì Yardƒ±mcƒ±lar =====
const MIRAGE_THRESHOLD = 5;      // ka√ß ‚ÄúYes, but‚Äù tƒ±klamasƒ±ndan sonra tetiklenecek
let mirageTriggered = false;     // tek sefer √ßalƒ±≈üsƒ±n

// Basit "typewriter"
async function typeLine(el, text, charDelay = 22) {
  for (let i = 0; i < text.length; i++) {
    el.textContent += text[i];
    await new Promise(r => setTimeout(r, charDelay));
  }
  el.textContent += "\n";
}
async function typeBlock(el, lines, lineDelay = 350, charDelay = 22) {
  for (const line of lines) {
    await typeLine(el, line, charDelay);
    await new Promise(r => setTimeout(r, lineDelay));
  }
}



// Ortada 98.css penceresi √ºret
function createCenteredTerminalWindow(title = "Network Mirage") {
  const wrapper = document.createElement("div");
  wrapper.className = "win98";
  wrapper.style.left = "50%";
  wrapper.style.top = "50%";
  wrapper.style.transform = "translate(-50%, -50%)";
  wrapper.style.zIndex = ++zCounter;

  wrapper.innerHTML = `
    <div class="window" style="width:360px;">
      <div class="title-bar">
        <div class="title-bar-text">${title}</div>
        <div class="title-bar-controls">
          <button aria-label="Close" class="close-ind"></button>
        </div>
      </div>
      <div class="window-body">
        <pre class="message-text" style="white-space: pre-wrap; min-height: 160px; margin:0;"></pre>
        <section class="field-row" style="justify-content:end; margin-top: 12px;">
          <button class="button">OK</button>
        </section>
      </div>
    </div>
  `;
  document.body.appendChild(wrapper);

  // Close -> kibarca kapat
  const closeBtn = wrapper.querySelector(".close-ind");
  const okBtn = wrapper.querySelector(".button");
  const kill = () => wrapper.remove();
  closeBtn.addEventListener("click", (e) => { e.stopPropagation(); kill(); });
  okBtn.addEventListener("click", kill);

  makeDraggable(wrapper, wrapper.querySelector(".title-bar"));
  return wrapper.querySelector(".message-text");
}

// Ana akƒ±≈ü
async function triggerNetworkMirage() {
  if (mirageTriggered) return;
  mirageTriggered = true;

  // üîí Etkile≈üimi kilitle
  const lock = document.createElement("div");
  lock.id = "mirage-lock";
  document.body.appendChild(lock);

  // Arka plan sesi kƒ±smak + hafif filtre
  const prevSeaVol = seaSound.volume;
  seaSound.volume = Math.max(0, prevSeaVol - 0.25);
  document.body.classList.add("network-mirage");

  const out = createCenteredTerminalWindow("Network Mirage");
  const t = new Date();
  const lastSeen = localStorage.getItem("mirage_visited");
  const lastSeenMsg = lastSeen ? `residual signal since ${new Date(+lastSeen).toLocaleString()}` : "no residuals found";

  const lines1 = [
    "> establishing subaquatic link...",
    "> scanning frequencies...",
    "> connecting to external nodes...",
    "",
    "> atlantic.node_002 .......... active",
    "> pacific.node_113 ........... unstable",
    "> arctic.node_042 ............ silent",
    "> mediterranean.node_089 ..... ping received",
    "> blacksea.node_local ........ listening",
    "",
    `> ${lastSeenMsg}`,
    `> timestamp: ${t.toLocaleString()}`
  ];
  const lines2 = [
    "",
    "> connection established with user: blacksea.node_local/you",
    "> mirage link complete.",
    "> wait‚Ä¶ who connected first?",
    ""
  ];
  const lines3 = [
    "> transmission feedback detected.",
    "> you are being mirrored.",
    ""
  ];

  
  await typeBlock(out, lines1, 330, 18);
  await new Promise(r => setTimeout(r, 350));
  await typeBlock(out, lines2, 300, 18);
  await new Promise(r => setTimeout(r, 300));
  await typeBlock(out, lines3, 320, 18);

  // üåä K√º√ß√ºk dalga efekti (filtre kaldƒ±r)
  setTimeout(() => {
    document.body.classList.add("end");
    setTimeout(() => {
      document.body.classList.remove("network-mirage", "end");
    }, 1500);
  }, 600);

  // üß† Hafƒ±za izi bƒ±rak
  localStorage.setItem("mirage_visited", Date.now().toString());


  // üîì Sim√ºlasyon tamamlandƒ±ktan sonra etkile≈üimi geri a√ß
  setTimeout(() => {
    lock.remove();
  }, 1000); // yazƒ± s√ºresine uygun olarak 7.5s sonra a√ßar
}


// A√ßƒ±lƒ±≈üta kalƒ±ntƒ± sinyal uyarƒ±sƒ± (tek satƒ±rlƒ±k mini pencere)
function bootMirageNoticeIfNeeded() {
  if (!localStorage.getItem("mirage_visited")) return;
  const out = createCenteredTerminalWindow("Residual Signal");
  out.textContent = "> previous mirage detected.\n> residual signal active.";
  setTimeout(() => {
    // k√º√ß√ºk ‚Äúparlama‚Äù
    document.body.classList.add("network-mirage");
    setTimeout(() => document.body.classList.remove("network-mirage"), 900);
  }, 250);
}

// ===== üåê Network Mirage ‚Äì Tetikleme noktalarƒ± =====
// 1) Sayfa a√ßƒ±lƒ±≈üƒ±nda kalƒ±ntƒ± bildirimi
bootMirageNoticeIfNeeded();

// 2) ‚ÄúYes, but‚Äù akƒ±≈üƒ± i√ßinde tetikle (setupNormal i√ßinde click sonrasƒ±)
const _setupNormal_orig = setupNormal;
setupNormal = function(wrapper) {
  const btn = wrapper.querySelector('.button');
  btn.addEventListener('click', () => {
    // tetik kontrol√º ‚Äì e≈üik yakalandƒ±ƒüƒ±nda mirage ba≈ülat
    if (clickCount + 1 >= MIRAGE_THRESHOLD && !mirageTriggered) {
      // pencere silinmeden √∂nce tetikleyelim ki akƒ±≈ü hissi b√∂l√ºnmesin
      setTimeout(triggerNetworkMirage, 200);
    }
  });
  // orijinal davranƒ±≈üƒ± koru
  _setupNormal_orig(wrapper);
};

</script>
</body>
</html>
